Changes in component 'nf-core/drep/dereplicate'
'modules/nf-core/drep/dereplicate/environment.yml' is unchanged
'modules/nf-core/drep/dereplicate/meta.yml' is unchanged
Changes in 'drep/dereplicate/main.nf':
--- modules/nf-core/drep/dereplicate/main.nf
+++ modules/nf-core/drep/dereplicate/main.nf
@@ -8,15 +8,16 @@
         : 'biocontainers/drep:3.6.2--pyhdfd78af_0'}"
 
     input:
-    tuple val(meta), path(fastas, stageAs: 'input_fastas/*')
+    tuple val(meta), path(fastas, stageAs: 'input_fastas/*'), path(quality_csv)
     tuple val(meta2), path(drep_work, stageAs: 'drep_work/')
 
     output:
-    tuple val(meta), path("dereplicated_genomes/*"), emit: fastas
-    tuple val(meta), path("data_tables/*.csv"), emit: summary_tables
-    tuple val(meta), path("figures/*pdf"), emit: figures
-    tuple val(meta), path("logger.log"), emit: log
-    path "versions.yml", emit: versions
+    tuple val(meta), path("dereplicated_genomes/*"), optional: true, emit: fastas
+    tuple val(meta), path("data_tables/*.csv")     , optional: true, emit: summary_tables
+    tuple val(meta), path("figures/*pdf")          , optional: true, emit: figures
+    tuple val(meta), path("logger.log")            , optional: true, emit: log
+    path "versions.yml"                                            , emit: versions
+    path "progress.log"                                            , emit: progress_log
 
     when:
     task.ext.when == null || task.ext.when
@@ -30,26 +31,53 @@
     fi
 
     find -L input_fastas/ -type f > fastas_paths.txt
+    GENOME_COUNT=\$(cat fastas_paths.txt | wc -l)
 
-    dRep \\
-        dereplicate \\
-        drep_work/ \\
-        -p ${task.cpus} \\
-        -g fastas_paths.txt \\
-        ${args} \\
+    if [[ \$GENOME_COUNT -eq 0 ]]; then
+        echo "No genomes found in input_fastas/"
 
-    ## We copy the output files to copies to ensure we don't break an already
-    ## existing drep_work/ from an upstream dRep module (e.g. compare)
-    mkdir dereplicated_genomes/ figures/ data_tables
-    cp drep_work/dereplicated_genomes/* dereplicated_genomes/
-    cp drep_work/figures/* figures/
-    cp drep_work/data_tables/* data_tables/
-    cp drep_work/log/logger.log logger.log
+    elif [[ \$GENOME_COUNT -eq 1 ]]; then
+        echo "Only one genome detected. Skipping dRep and copying genome directly."
+        
+        # Copy the single genome to dereplicated_genomes
+        cp input_fastas/* dereplicated_genomes/
+        
+        # Create minimal output files required by PROPAGATE_TAXONOMY_TO_BINS process
+        GENOME_NAME=\$(basename input_fastas/*)
+        echo "genome,cluster" > data_tables/Wdb.csv
+        echo "\$GENOME_NAME,1_0" >> data_tables/Wdb.csv
+        echo "genome,secondary_cluster" > data_tables/Cdb.csv
+        echo "\$GENOME_NAME,1_0" >> data_tables/Cdb.csv
+        
+    else
+        echo "Multiple genomes detected (\$GENOME_COUNT). Running dRep."
+        
+        dRep \\
+            dereplicate \\
+            drep_work/ \\
+            -p ${task.cpus} \\
+            -g fastas_paths.txt \\
+            --genomeInfo ${quality_csv} \
+            ${args} \\
+
+        ## We copy the output files to copies to ensure we don't break an already
+        ## existing drep_work/ from an upstream dRep module (e.g. compare)
+        mkdir dereplicated_genomes/ figures/ data_tables
+        cp drep_work/dereplicated_genomes/* dereplicated_genomes/
+        cp drep_work/figures/* figures/
+        cp drep_work/data_tables/* data_tables/
+        cp drep_work/log/logger.log logger.log
+    fi
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":
         drep: \$(dRep | head -n 2 | sed 's/.*v//g;s/ .*//g' | tail -n 1)
     END_VERSIONS
+
+    cat <<-END_LOGGING > progress.log
+    ${meta.id}\t${task.process}
+        genomes_folder: \$(ls genomes_folder | wc -l), dereplicated: \$(ls drep_output/dereplicated_genomes | wc -l)
+    END_LOGGING
     """
 
     stub:
@@ -69,5 +97,10 @@
     "${task.process}":
         drep: \$(dRep | head -n 2 | sed 's/.*v//g;s/ .*//g' | tail -n 1)
     END_VERSIONS
+
+    cat <<-END_LOGGING > progress.log
+    ${meta.id}\t${task.process}
+        input_fastas: \$(ls input_fastas | wc -l), dereplicated: \$(ls dereplicated_genomes/ | wc -l)
+    END_LOGGING
     """
 }

'modules/nf-core/drep/dereplicate/tests/main.nf.test.snap' is unchanged
'modules/nf-core/drep/dereplicate/tests/nextflow.config' is unchanged
'modules/nf-core/drep/dereplicate/tests/main.nf.test' is unchanged
************************************************************
